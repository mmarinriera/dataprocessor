requires = [ "tox>=4" ]
envlist = [ "py310", "py311", "py312", "py313", "coverage", "examples", "prek", "ty" ]

[env_run_base]
description = "Running tests"
runner = "uv-venv-lock-runner"
with_dev = true
dependency_groups = [ "dev" ]
commands = [ [ "coverage", "run", "-p", "-m", "pytest" ] ]

[env.coverage]
skip_install = true
deps = "coverage[toml]"
depends = [ "3.*" ]
commands = [
  [ "coverage", "combine" ],
  [ "coverage", "report", "--fail-under=10" ],
  [ "coverage", "html" ],
]

[env.examples]
description = "Running example scripts to ensure they work correctly."
runner = "uv-venv-lock-runner"
commands = [
  [ "python", "examples/simple_pipeline.py" ],
  [ "python", "examples/text_pipeline.py" ],
  [ "python", "examples/multiple_outputs_pipeline.py" ],
]

[env.prek]
description = "Running pre-commit checks (formatting, linting, type checking) with prek."
runner = "uv-venv-runner"
skip_install = true
deps = "prek==0.3.4"
commands = [
  [ "prek", "run", "--all-files", "--show-diff-on-failure" ],
]

[env.ty]
description = "Running type checks with ty."
runner = "uv-venv-runner"
skip_install = true
deps = "ty==0.0.19"
commands = [
  [ "ty", "check" ],
]
